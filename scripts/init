#!/usr/bin/bash

confirm() {
  local answer
  read -rp "Override \`.bashrc\` and \`.bash_profile\`? (overriden files will be backed up with a timestamp) [Y/n] " answer
  if [ -n "$answer" ] && [ "$answer" != "y" ]; then
    echo Aborting.
    exit 0
  fi
}

createFile() {
  local out_file="$1"
  {
    echo -e "#!$(command -v bash)\n"
    echo -e "### do not edit this file \n### it was generated via the $(readlink -f "$0") script\n\n"
  } >"$out_file"
}

appendContent() {
  local input_folder out_file
  out_file="$1"
  input_folder="$2"
  for f in "$input_folder"*; do
    {
      echo "### ${f} ###"
      grep -v '^#!' "$(readlink -f "$f")"
      echo -e "### eo ${f} ###\n"
    } >>"$out_file"
  done
}

generateScript() {
  local input_folder out_file
  input_folder="$1"
  out_file="$2"

  cp "$out_file" "${out_file}.$(date +"%Y%m%d%H%M")"
  createFile temp
  appendContent temp "$input_folder"

  mv temp "$out_file"
}

# confirm
generateScript "./bash_profile/" "${HOME}/.bash_profile"
generateScript "./bashrc/" "${HOME}/.bashrc"
# shellcheck disable=1091
source "${HOME}/.bash_profile"
echo Done.
